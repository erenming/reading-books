# 数据库

- 数据库切换
    1. 通过修改`redisClient.db`指针，让它指向服务器中的不同数据库，从而实现切换目标数据库的功能
- 数据库整体例子
    ![xx](https://raw.githubusercontent.com/erenming/reading-books/master/implement-of-redis/images/WX20190513-224918@2x.png)
    1. dict: 负责保存键值对
    2. expires: 负责保存键的过期时间
- 过期删除策略
    1. 定时删除
        - 设置键的过期时间的同时，创建一个定时器(timer)，让定时器在键的过期时间来临时，立即执行对键的删除
        - 评价：CPU消耗大，内存消耗小
    2. 惰性删除
        - 放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键；如果没有过期，就返回该键
        - 评价：CPU消耗小，内存占用大(可能发生内存泄露)
    3. 定期删除
        - 每隔一段时间，程序就对数据库进行一次检查，删除里面的过期键
        - 评价：上述两种的折中，在于确定删除操作执行的时长和频率
- AOF、RDB和复制功能对过期键的处理
    1. 生成RDB文件
        - 已过期的键不会被保存到新创建的RDB文件中
    2. 载入RDB文件
        - 对于主服务器，过期键不会被载入
        - 对于从服务器，无论是否过期均被导入(同步时，会处理)
    3. AOF文件写入
        - 不受过期键影响
    4. AOF重写
        - 过期键被忽略
    5. 复制
        - 对于主服务器，删除一个过期键，会显式地向所有从服务器发送一个`DEL`命令，告诉从服务器删除这个过期键
        - 对于从服务器，客户端发送读命令，即使碰到过期键也不会将过期键删除，而继续以未过期处理
        - 从服务器只有在接到主服务器发来的DEL命令之后，才会删除过期键
        - 这种统一、中心化的过期键删除策略可以保证主从服务器数据的一致性
- 数据库通知
    1. 让客户端订阅给定的频道或者模式，来获知数据库中的键的变化，以及数据库中命令的执行情况
